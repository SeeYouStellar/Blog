### osi模型

1. 应用层：各种应用采用不同的应用层协议完成不同类型的应用要求
2. 表示层
3. 会话层
4. 传输层：提供端到端的可靠传输服务（进程与进程之间），并提供流量控制、差错检测
5. 网络层：提供点到点的传输，主要解决点到点之间的路由选择与分组转发，支持无连接和面向连接
6. 数据链路层：将数据包分装成帧，并提供流量控制、差错检测
7. 物理层

### TCP/IP模型

与OSI区别在于：

1. 传输层提供面向连接和无连接服务，网络层仅有无连接
2. 只在传输层提供流量控制，帧丢失差错检测，在数据链路层提供比特差错检测

### 波特率和比特率

**波特率**是单位时间码元传输速率，比特率是单位使劲比特传输速率

一个k进制码元可携带 $log_2{k}$ 个比特

### 奈奎斯特定理和香农定理

**码间串扰**：能通过信道的频率范围是一定的，当高频率信号无法通过信道时，高低频率码元之间的界限出现模糊

**信噪比**：信道传输功率/噪声功率

奈奎斯特定理：极限信道传输速率和信道带宽有关

香浓定理：信道传输速率不仅和信道带宽有关，还和信噪比有关。信噪比越大，信道传输速率越大。

### 数据交换的三种方式的对比
1. 电路交换：三步骤，建立连接-->传输数据-->连接释放。建立连接的时间比较长。且独占信道，适合传输数据量大的时候，信道利用率低且一旦出差错就会导致数据传输失败，无法控制。
2. 报文交换：不需要建立连接，随时发随时接收即可。结点具有存储转发的功能，每个结点接受整个报文之后进行检测，检测无误执行转发，故会存在延迟时间。缺点就是报文大小不确定，结点的存储管理不好控制，且延迟时间较长。
3. 分组交换：将报文划分为长度相同的分组，每个分组都有相应的原地址+目的地址+序号等信息，进行存储转发操作。好处是，分组可以可以并行进行转发，延迟时间缩短且因为分组大小固定所以易于存储的管理。缺点就是，因为每个分组都要加地址信息以及编号之类的，所以增加了传输的数据量。

## 网络层

### 子网掩码

当IP地址由二级结构变为三级结构时，主机号被分成了子网号和主机号两部分，此时每个网段的网络号就不是固定长度了，所以需要用子网掩码来判别网络号。子网掩码将网络号部分全部为1，其余为0，将子网掩码和IP地址做与操作可以得到网段地址

### 冲突域、广播域

冲突域：当某两台计算机在发送数据时会产生冲突，那么这两台计算机就处于同一个冲突域

广播域：指网络中的某一设备同时向网络中所有的其它设备发送数据，个数据所能广播到的范围即为广播域

### 路由器、交换机、集线器

路由器：

1. 由（目的IP地址，下一跳IP地址）组成
2. 端口具有mac地址和ip地址
3. 路由器实际包含了交换机（所以有mac地址），交换机（交换表）来完成**分组转发**，路由表来完成**路由选择**

交换机：

1. 由（目的MAC地址，端口号）组成。
2. 可以扩大冲突域，每一个端口都是一个冲突域，端口具有mac地址。但每个端口都属于一个广播域，因为当一个新的目的mac地址需要到达时，交换机会向所有端口广播该数据帧，说明每个端口同属一个广播域
3. 具有学习功能
4. 内部是电路连接式，一旦找到端口号就会使发送方独占线路
5. 全双工
6. 工作在数据链路层

集线器：

1. 无学习功能
2. 内部是总线型
3. 工作在物理层
4. 半双工
5. 不可以扩大冲突域，所有连接的终端都同属一个网段

### 内部网关协议

RIP：路由器根据距离想来来决定下一跳。路由器表项变为（目的地址，下一跳地址，到目的总距离）。路由器每隔一段时间只与相邻路由器交换路由表信息。这种协议只基于跳数，而没有考虑其他网路因素。使用UDP来RIP报文，RIP报文作为UDP的数据部分。

OSPF：开放最短路径优先算法。链路张太发生变化时，在路由器间洪范式发送变化信息，包括网络状况，跳数，时延带宽。直接使用IP报文传送，OSPF报文作为IP的数据部分。

### 虚拟局域网VLAN

通过四个交换机实现三个VLAN（其中一个交换机连接三个交换机），使用802.1Q格式的数据帧，帧中包含来自哪个虚拟局域网的标志，这样就可以做到不接受同一个局域网的广播，而接收同一个虚拟局域网的广播。

### IPV6与IPV4区别

1. 地址长度由32位到128位
2. 可以分更多的层级网络

### IP多播

由路由器硬件实现将一个多播数据报复制多份，发送到多个主机。

多播地址为D类地址，开头为1110，每一个地址代表一个多播组。

使用IGMP网际管理协议和RPB反向路径广播策略

## TCP

### TCP首部

1. 源端口、目的端口
2. 序号：本数据报是整个应用程序传下来的报文中的第几个分报文，序号代表这个分报文的首字节在整个报文中是第几个字节
3. 确认序号：接收方收到报文后，计算得到下一个应该接收报文的序号是多少。即整个报文的末字节序号+1
4. 数据偏移（4Byte）：TCP报文中数据部分在整个报文的哪个位置，数据偏移*4即为字节偏移量。
5. URG：紧急位。URG=1，表示紧急指针字段有效。
6. ACK：确认位。为1时确认序号有效。建立连接后双方都要将该位置1
7. SYN：同步位。SYN=1，ACK=0，表示这是一个建立连接请求。
8. FIN：终止位。释放连接。FIN=1，表示发送该报文方的数据已经全部发送完毕
9. 窗口大小：用来告诉对方本方接收缓存大小。
10. 检验和：与伪首部一起使用
11. 紧急指针：指出紧急字段在报文中结束的位置。
12. SACK：选择确认字段。该位是当连接需要用到选择确认时，连接双方在发送报文时才会加上的字段。这个字段包括确认位，每个不连续块的左右边界。

### TCP和UDP的区别

1. UDP面相报文，应用程序交付多大的报文，UDP都原封不动加上首部后传给网络层；TCP面相字节流，不管应用层交付多大的报文，TCP都按照接收方的接收窗口大小和网络拥塞程度决定报文的大小。即UDP不会分片，而TCP会分片，在两点之间传输时UDP始终看到的是整个报文，而TCP始终看到的是被分成多个的报文（字节流），这就要求接收方应用程序要有能力辨识这些报文（所以也会产生**粘包问题**——数据的无界性），哪些是属于同一个报文、等等。
2. UDP无连接，TCP面相连接。UDP首部中虽有源端口、目的端口以及伪首部中的目的ip、源ip，但是UDP两点之间交互不是通过套接字，而TCP是通过套接字建立连接。
3. 根据第一点区别，也就说明UDP没有拥塞控制，而TCP有拥塞控制。
4. UDP首部开销小，只有8个字节，TCP首部开销大，有20个字节。
5. TCP可靠传输，UDP尽最大能力交付整个报文。
6. TCP建立连接的两端都有有发送缓存和接收缓存，所以可工作在全双工下。
7. TCP协议是流量控制，拥塞控制，连接管理的集合

### TCP和UDP的相同点

1. 两者首部都有检验和，所以都可以对整个报文进行差错检验

### TCP的可靠传输实现

以自动重传请求ARQ为基础。指的是发送端在发送一个数据包后设置一个超时计时器，若接收方的确认超出该时间，发送方自动重发。

但上述协议导致信道利用率不高。信道利用率=数据发生数据时间 / (数据发送数据时间+传输时延+确认报文传输时间)

所以就可以使用连续ARQ协议。该协议内容可分为三点：滑动窗口技术、累计确认、回退机制

### TCP的流量控制

控制点对点之间的通信量。

使用滑动窗口技术实现。在传输时用窗口、确认序号字段控制。

TCP发送缓存中的数据何时发送也是一个问题。解决的方法有：缓存数到达MSS时，将这些字节打包发送；按照应用程序的要求来发送；设置发送计时器，按时发送。

滑动窗口的问题：糊涂窗口综合征，当接收方应用程序每次只接受一个字节时，滑动窗口只能一个字节一个字节移动。

### TCP的拥塞控制

控制整个网络的通信量。

四个步骤：慢开始、拥塞避免、快重传、快恢复

**慢开始**阶段：接收方设置cwnd(拥塞窗口)为1，设置ssthresh(慢开始门限)，单位都为报文段。没收到一个确认报文，就将cwnd+1。每轮传输轮回使cwnd*2，是指数增长。

当cwnd>ssthresh时，进入**拥塞避免**阶段：每一个传输轮次cwnd+1，变为线性增长。当出现确认超时时，说明网络出现拥塞，那么使cwnd=1，ssthresh=ssthresh/2

当出现连续几个相同序号ack到达时，说明错误使用了拥塞避免，网络只是满了，未出现拥塞，执行**快恢复**算法，此时需要调整ssthresh=cwnd/2，cwnd=ssthresh。然后进行拥塞避免。

上述出现的连续几个相同序号ack到达即为**快重传**算法，当接收方未收到一个序号时，只要发送方发送了一个其他序号的报文，接收方就发送一个确认序号。

### TCP连接管理——三次握手

一开始A、B进程都为CLOSED状态。两者打开后，B进入LISTEN状态。

A发送SYN报文（ACK=0, SYN=1, seq=x），而后进入SYN_SENT状态。

B收到SYN报文后，发送ACK报文（ACK=1, SYN=1, seq=y, ack=x+1），而后进入SYN_RECV状态。

A收到ACK报文后，发送ACK报文（ACK=1, SYN=1, seq=x+1, ack=y+1），而后进入ESTABLISHED状态。

B收到ACK报文后，进入ESTABLISHED状态。

**为什么要进行三次握手？**

实际上可以将连接建立的过程看成接收双方接收能力的确认，一旦双方的接收能力都没有问题，就可以进行数据交互。第一次握手，接收方知道发送方发送能力没问题；第二次握手，发送方知道接收方发送和接收能力都没问题；第三次握手，接收方知道发送方接收能力没问题。

**为什么不是四次握手**

接收方发送的ACK报文包含两个信息，分别是ACK和SYN，也可以把这两个信息分开发，就变为了四次握手。

### TCP连接管理——四次挥手

一开始A,B进程都为ESTABLISHED状态。

A发送FIN报文（FIN=1，seq=x）,随后进入FIN_WAIT_1状态。

B收到FIN报文，发送ACK报文（ACK=1,seq=y,ack=x+1）,进入CLOSE_WAIT状态。

此时服务器端B可能还要发一些数据，故不能将FIN报文和ACK一起发，也就是为什么挥手一定是四次。

A收到ACK报文，进入FIN_WAIT_2状态。

B再发送FIN报文（FIN=1，ACK=1，seq=y+1，ack=x+1），进入LAST_ACK状态。B不再发数据。

A收到FIN报文后，发送ACK报文（ACK=1, seq=x+1,ack=y+2）,进入TIME_WAIT状态。

B收到ACK报文后，进入CLOSED状态。

A等待2MSL（2个最长报文寿命时间）后，进入CLOSED状态。

### 为什么UDP不提供端到端的可靠连接却还需要在头部写入目的端口号和源端口号

因为运输层本质是解决进程之间的连接的，如果连进程端口都不知道还怎么连接呢

## 应用层

### DNS协议

域名解析协议。通过分布式的域名解析服务器来对用户发送的域名解析请求做出反应。根域名服务器、顶级域名服务器、本地域名服务器、权限域名服务器、发送方自身的电脑构成了整个分布式系统。

查询方式包括迭代查询、递归查询。

### FTP协议

文件传送协议

### 万维网www

URL定义：统一资源定位符。互联网的所有资源都有一个唯一的URL。

URL组成：<协议>://<主机域名>:<端口号>/<路径>

### HTTP

超文本传送协议，无连接、无状态，使用TCP

在TCP三次握手中，用户端接收到第二次握手信息后，就发送HTTP请求报文（与TCP第三次握手报文一起）。然后服务器接收到该报文后，就把页面信息发送给客户端。